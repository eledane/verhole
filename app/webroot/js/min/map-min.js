function initialize(){$("#submit-maps").click(function(){google.maps.event.trigger(input,"focus"),google.maps.event.trigger(input,"keydown",{keyCode:13})}),map=new google.maps.Map(document.getElementById("map-canvas"),mapOptions),infowindow=new InfoBox,map.setCenter(currentPosition);var e=!0;google.maps.event.addListener(map,"bounds_changed",function(){e&&(setMarkers(map,map.getBounds(),!1),sortElements(),e=!1)});var a=new google.maps.Marker({map:map});actionAfterChangePlace(a),initCheckboxControl();var t={styles:[{height:59,url:"/img/map_pin_empty.png",width:60,textSize:14}]};mc=new MarkerClusterer(map,markersArray,t)}function clearOverlays(){for(var e=0;e<markersArray.length;e++)markersArray[e].setMap(null);markersArray.length=0}function setMarkers(e,a,t){clearOverlays(),setCheckboxOptions();var o={url:"/img/"+o,size:new google.maps.Size(51,58),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(25,58)};markersArray=[];for(var n=0;n<markers.length;n++){t&&(markers[n].display=!1);var r=markers[n];if(!options.reqCashLoans&&r.reqCashLoans===!options.reqCashLoans||!options.reqElectronics&&r.reqElectronics===!options.reqElectronics||!options.reqMotorbike&&r.reqMotorbike===!options.reqMotorbike){var s=new google.maps.LatLng(r.lat,r.lng),i=new google.maps.Marker({position:s,map:e,icon:r.marker,title:r.name,zIndex:r.id});if(markersArray.push(i),a.contains(i.getPosition())||markers[n].display){t&&(markers[n].display=!0);var c=r.id;$("#markers-list .map-marker[data-target="+c+"]").length?$("#markers-list .map-marker[data-target="+c+"] span").html(r.distance):$("#markers-list .maps-div-scroll").append('<div class="map-marker" data-lat="'+r.lat+'" data-lng="'+r.lng+'" data-distance="'+r.distanceInMeters+'" data-target="'+c+'" onclick="openPlace('+c+", "+r.lat+", "+r.lng+')"><span>'+r.distance+'</span><div class="icon"><img alt="" src="'+r.logo+'"></div><div class="desc"><p class="name">'+r.name+'</p><p class="address">'+r.address+"</p></div></div>")}else $("#markers-list .map-marker[data-target="+r.id+"]").remove();addInfoWindow(i,r)}else $(".infoBox  > div[data-id="+r.id+"]").parent().fadeOut(),$("#markers-list .map-marker[data-target="+r.id+"]").remove()}mc.clearMarkers(),mc.addMarkers(markersArray)}function actionAfterChangePlace(e){var a=document.getElementById("pac-input"),t=new google.maps.places.SearchBox(a);t.bindTo("bounds",map),google.maps.event.addListener(t,"places_changed",function(){infowindow.close(),$("#markers-list").fadeIn();var a=t.getPlaces();a=a[0],a.geometry&&(a.geometry.viewport?map.fitBounds(a.geometry.viewport):(map.setCenter(a.geometry.location),map.setZoom(zoom)),currentPosition=a.geometry.location,setMarkerDistance(),setMarkers(map,map.getBounds(),!0),setMarkerWithCurrentPosition(e),sortElements())})}function setMarkerDistance(){for(var e=0;e<markers.length;e++)calcRoute(e,currentPosition,new google.maps.LatLng(markers[e].lat,markers[e].lng));return!0}function setMarkerWithCurrentPosition(e){e.setVisible(!1),e.setIcon({url:"/img/"+currentPositionMarker,size:new google.maps.Size(50,57),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(25,57)}),e.setPosition(currentPosition),e.setVisible(!0)}function handleNoGeolocation(e){if(e)var a="Error: The Geolocation service failed.";else var a="Error: Your browser doesn't support geolocation.";var t={map:map,position:currentPosition,content:a},o=new InfoBox(t);map.setCenter(t.position)}function openPlace(e,a,t){$(window).width()<993&&($("#markers-list .maps-div-scroll-wrap").toggleClass("active"),$(this).toggleClass("active"));var o=new google.maps.LatLng(a+2,t);map.setCenter(o),google.maps.event.trigger(markersArray[e],"click")}function calcRoute(e,a,t){var o={origin:a,destination:t,travelMode:google.maps.TravelMode.DRIVING};directionsService.route(o,function(a,t){if(t==google.maps.DirectionsStatus.OK){var o=a.routes[0].legs[0].distance.text,n=0;n=o.indexOf("km")>0?1e3*parseInt(o.substr(0,o.indexOf(" "))):parseInt(o.substr(0,o.indexOf(" "))),markers[e].distanceInMeters=n,markers[e].distance=o,$("#markers-list .map-marker[data-target="+markers[e].id+"]").data("distance",markers[e].distanceInMeters),$("#markers-list .map-marker[data-target="+markers[e].id+"] span").html(markers[e].distance),sortElements()}else markers[e].distance=""})}function setCurrentPositionFromBrowser(e){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(a){currentPosition=new google.maps.LatLng(a.coords.latitude,a.coords.longitude),map.setCenter(currentPosition),setMarkerWithCurrentPosition(e)},function(){handleNoGeolocation(!0)}):handleNoGeolocation(!1)}function initCheckboxControl(){$("#map-top-controls .checkbox").click(function(){$(this).find(".checkbox-item").hasClass("active")?$(this).find(".checkbox-item").removeClass("active"):$(this).find(".checkbox-item").addClass("active"),setMarkers(map,map.getBounds(),!1),sortElements()})}function setCheckboxOptions(){options={reqCashLoans:$("#checkbox_0").hasClass("active"),reqElectronics:$("#checkbox_1").hasClass("active"),reqMotorbike:$("#checkbox_2").hasClass("active")}}function sortElements(){var e=$("#markers-list .maps-div-scroll"),a=e.find(".map-marker").length;$("#count-of-search-items").html(a),a>0?$(".result-number").addClass("can-open"):($(".result-number").removeClass("can-open"),$("#markers-list .maps-div-scroll-wrap").removeClass("active"),$(".result-number ").removeClass("active")),e.find(".map-marker").sort(function(e,a){return+$(e).data("distance")-+$(a).data("distance")}).appendTo(e)}function addInfoWindow(e,a){var t="",o='<div id="content" data-id="'+a.id+'"><h1 id="firstHeading" class="firstHeading" style="color: #fe0000; font-size: 18px; margin: -5px 0 0 0;"><img src="'+a.logo+'">&nbsp;'+a.name+'</h1><div id="bodyContent"><div class="info-item" style=" padding: 12px 0;"><h2 style="color: #fe0000; font-size: 16px; font-weight: bold; margin: 0 0 10px 0;">'+translations.address[currentLanguage]+':</h2><p style="color: #000; font-size: 14px; margin: 0;">'+a.address+"</p></div>";"undefined"!=typeof a.openHour&&""!=a.openHour&&(o+='<div class="info-item" style="padding: 12px 0 10px 0; border-top: 1px solid #d8d8d8;"><h2 style="color: #fe0000; font-size: 16px; font-weight: bold; margin: 0 0 10px 0;">'+translations.hours[currentLanguage]+':</h2><p style="color: #000; font-size: 14px; margin: 0;">'+a.openHour+"</p></div>"),o+='<div class="info-item" style=" padding: 17px 0 5px 0; border-top: 1px solid #d8d8d8;">',a.reqElectronics&&(o+='<img src="/img/icon-nav-electronics.png" style="margin-right: 15px;" alt="'+translations.electronics[currentLanguage]+'" title="'+translations.electronics[currentLanguage]+'"/>'),a.reqMotorbike&&(o+='<img src="/img/icon-nav-motorbikes.png" style="margin-right: 15px;" alt="'+translations.motorbikes[currentLanguage]+'" title="'+translations.motorbikes[currentLanguage]+'"/>'),a.reqCashLoans&&(o+='<img src="/img/icon-nav-cash-loans.png" style="margin-right: 15px;" alt="'+translations.cashloans[currentLanguage]+'" title="'+translations.cashloans[currentLanguage]+'"/>'),o+="</div>",o+="</div></div>";var n=new InfoBox({content:o,pixelOffset:new google.maps.Size(-5,-25),alignBottom:!0,boxStyle:{background:"#fff",width:"310px",position:"relative",padding:"18px 15px 13px 15px",boxShadow:"0 1px 15px rgba(0, 0, 0, 0.3)"},closeBoxPosition:"0 0px 0px -25px",closeBoxURL:"/img/close-btn.png",infoBoxClearance:new google.maps.Size(0,0)});google.maps.event.addListener(e,"click",function(){$(".infoBox").fadeOut(100),$(".map-marker").removeClass("active"),$(".map-marker[data-target="+(e.zIndex-1)+"]").addClass("active"),n.close(),n.open(map,e)})}function isScrolledIntoView(e){var a=$(window).scrollTop(),t=a+$(window).height(),o=$(e).offset().top,n=o+$(e).height();return t>=n&&o>=a}var directionsService=new google.maps.DirectionsService({suppressMarkers:!0}),currentPosition=new google.maps.LatLng(21.024107,105.841523),markersArray=[],currentPositionMarker="map_pin_current_position.png",defaultMarker="map_pin.png",infowindow,zoom=16,map,mc,mapOptions={},options={reqCashLoans:!1,reqElectronics:!1,reqMotorbike:!1},currentLanguage,translations={address:{en:"Address",vi:"Địa chỉ"},hours:{en:"Opening hours",vi:"Giờ mở cửa"},electronics:{en:"Electronic shops",vi:"Điện tử gia dụng"},motorbikes:{en:"Motorbike shops",vi:"Xe máy"},cashloans:{en:"Cash loans",vi:"Vay tiền mặt"}};$(document).ready(function(){currentLanguage=$("html").attr("lang"),google.maps.event.addDomListener(window,"load",initialize);var e=!1;$(window).width()<993&&(e=!0,$(".btn-touch").addClass("active")),mapOptions={zoom:10,scrollwheel:!1,disableDefaultUI:!0,disableDoubleClickZoom:e,draggable:!e,position:currentPosition},$(".open-checkboxes").click(function(){$(window).width()<993&&($(this).hasClass("active")?($("#type-selector .checkbox").fadeOut(),$("#type-selector").animate({height:"0px"}),$(this).removeClass("active")):($("#type-selector").animate({height:"105px"}),$("#type-selector .checkbox").fadeIn(),$(this).addClass("active")))}),$(".btn-touch").click(function(){var e=!0;$(".btn-touch").hasClass("active")&&(e=!1),map.setOptions({draggable:!e}),map.setOptions({disableDoubleClickZoom:e}),$(".btn-touch").toggleClass("active")}),$(".result-number").show(),$("#markers-list .result-number").click(function(){$(this).hasClass("can-open")&&($("#markers-list .maps-div-scroll-wrap").toggleClass("active"),$(this).toggleClass("active"))}),$(".btn-gps").click(function(){var e=new google.maps.Marker({map:map});setCurrentPositionFromBrowser(e)}),$(".btn-zoom-in").click(function(){var e=map.getZoom();21!=e&&map.setZoom(e+1)}),$(".btn-zoom-out").click(function(){var e=map.getZoom();0!=e&&map.setZoom(e-1)})}),$(document).on({DOMNodeInserted:function(){$(".pac-item, .pac-item span",this).addClass("needsclick")}},".pac-container");